# Git Commit 规范指南

本文档提供了生成高质量 commit message 的规范和最佳实践。

## Commit Message 结构

标准的 commit message 包含三个部分：

```
<类型>(<作用域>): <简短描述>

<详细说明>

<页脚>
```

### 类型（Type）

必须是以下之一：

- **feat**: 新功能（feature）
- **fix**: 修复 bug
- **docs**: 仅文档更改
- **style**: 不影响代码含义的更改（空格、格式化、缺少分号等）
- **refactor**: 既不修复 bug 也不添加功能的代码更改
- **perf**: 提高性能的代码更改
- **test**: 添加缺失的测试或更正现有测试
- **chore**: 对构建过程或辅助工具和库的更改，如文档生成

### 作用域（Scope）

可选，表示改动影响的范围。例如：

- **backend**: 后端相关
- **frontend**: 前端相关
- **api**: API 相关
- **ui**: 用户界面
- **db**: 数据库
- **auth**: 认证/授权
- **config**: 配置相关
- **docs**: 文档
- **test**: 测试
- **scripts**: 脚本

### 简短描述（Subject）

- 使用祈使句，现在时态："添加"而不是"已添加"或"添加了"
- 不要大写首字母
- 结尾不加句号
- 不超过 50 个字符（中文约 25 个字）

### 详细说明（Body）

可选，提供更详细的改动说明：

- 说明为什么做这个改动
- 如何解决的问题
- 有什么副作用或影响

每行不超过 72 个字符。

### 页脚（Footer）

可选，用于：

- 引用相关的 issue：`Closes #123, #456`
- 注明破坏性变更：`BREAKING CHANGE: ...`

## 示例

### 示例 1：新功能

```
feat(auth): 实现 JWT 身份验证

- 添加 JWT token 生成和验证逻辑
- 实现登录和注销接口
- 添加认证中间件保护受限路由

主要文件：
- src/auth/jwt.py
- src/middleware/auth.py
- tests/test_auth.py
```

### 示例 2：Bug 修复

```
fix(reports): 修复报表中日期显示错误的问题

时区转换逻辑有误，导致报表中的日期比实际早一天。
现在统一使用 UTC 时间戳进行处理。

Closes #234
```

### 示例 3：重构

```
refactor(database): 优化数据库查询性能

- 添加适当的索引
- 重构复杂查询为多个简单查询
- 使用缓存减少数据库访问

性能提升约 40%
```

### 示例 4：文档更新

```
docs: 更新 API 文档

添加新增接口的说明和示例代码
```

### 示例 5：样式调整

```
style: 统一代码格式

运行 black 和 isort 格式化所有 Python 文件
```

### 示例 6：测试

```
test(api): 增加用户管理 API 的测试用例

覆盖创建、更新、删除用户的各种场景
```

### 示例 7：日常维护

```
chore: 更新依赖包版本

- 升级 Django 到 4.2
- 更新其他安全补丁
```

## 根据变更自动判断类型

### 新增文件场景

- 新增功能文件 → `feat`
- 新增测试文件 → `test`
- 新增文档文件 → `docs`
- 新增配置文件 → `chore`

### 修改文件场景

通过 diff 内容判断：

- 包含 "fix", "bug", "issue", "error", "correct" → `fix`
- 包含 "add", "new", "feature", "implement" → `feat`
- 包含 "refactor", "restructure", "reorganize" → `refactor`
- 包含 "style", "format", "lint" → `style`
- 修改测试文件 → `test`
- 修改文档文件 → `docs`
- 其他 → `chore`

### 删除文件场景

- 删除无用代码 → `chore`
- 移除废弃功能 → `refactor`

## 最佳实践

1. **提交频率**：
   - 小功能完成时提交
   - 一个逻辑单元一次提交
   - 不要混合多个不相关的改动

2. **消息质量**：
   - 清晰描述"做了什么"
   - 如有必要，说明"为什么"
   - 使用具体的语言，避免模糊的描述

3. **原子性**：
   - 每次提交应该是一个完整的、可工作的改动
   - 如果回退这次提交，不应破坏代码库

4. **可读性**：
   - 使用团队统一的语言（中文或英文）
   - 保持格式一致
   - 简短但信息完整

## 常见错误

❌ **太模糊**
```
chore: 更新
```

✓ **具体明确**
```
feat(api): 添加用户头像上传接口
```

---

❌ **混合多个改动**
```
feat: 添加登录功能，修复报表 bug，更新文档
```

✓ **分开提交**
```
feat(auth): 添加用户登录功能
fix(reports): 修复日期显示错误
docs: 更新 API 使用文档
```

---

❌ **使用过去时**
```
feat: 已经添加了新功能
```

✓ **使用祈使句**
```
feat: 添加新功能
```
