---
name: xlsx-zh
description: "全面的电子表格创建、编辑和分析功能，支持公式、格式化、数据分析和可视化。当 Claude 需要处理电子表格（.xlsx、.xlsm、.csv、.tsv 等）时使用：(1) 创建带有公式和格式的新电子表格，(2) 读取或分析数据，(3) 修改现有电子表格同时保留公式，(4) 电子表格中的数据分析和可视化，或 (5) 重新计算公式"
license: 专有许可证 - Anthropic
---

# 输出要求

## 所有 Excel 文件

### 公式零错误
- 每个 Excel 模型必须在交付时达到零公式错误（#REF!、#DIV/0!、#VALUE!、#N/A、#NAME?）

### 保留现有模板（更新模板时）
- 修改文件时，研究并**精确**匹配现有的格式、样式和约定
- 不要对已有固定模式的文件强加标准化格式
- 现有模板约定**始终**优先于这些指南

## 财务模型

### 颜色编码标准
除非用户或现有模板另有说明

#### 行业标准颜色约定
- **蓝色文字（RGB: 0,0,255）**：硬编码输入值，以及用户用于场景分析时需要更改的数字
- **黑色文字（RGB: 0,0,0）**：所有公式和计算结果
- **绿色文字（RGB: 0,128,0）**：从同一工作簿内其他工作表拉取的链接
- **红色文字（RGB: 255,0,0）**：指向其他文件的外部链接
- **黄色背景（RGB: 255,255,0）**：需要关注的关键假设或需要更新的单元格

### 数字格式标准

#### 必需的格式规则
- **年份**：格式化为文本字符串（例如 "2024" 而非 "2,024"）
- **货币**：使用 $#,##0 格式；**始终**在标题中指定单位（"Revenue ($mm)"）
- **零值**：使用数字格式将所有零显示为 "-"，包括百分比（例如 "$#,##0;($#,##0);-"）
- **百分比**：默认使用 0.0% 格式（一位小数）
- **倍数**：估值倍数（EV/EBITDA、P/E）格式化为 0.0x
- **负数**：使用括号 (123) 而非负号 -123

### 公式构建规则

#### 假设值放置
- 将**所有**假设值（增长率、利润率、倍数等）放在单独的假设单元格中
- 在公式中使用单元格引用而非硬编码值
- 示例：使用 =B5*(1+$B$6) 而非 =B5*1.05

#### 公式错误预防
- 验证所有单元格引用正确无误
- 检查范围中的差一错误
- 确保所有预测期间的公式一致
- 使用边界情况测试（零值、负数）
- 验证没有意外的循环引用

## 关键：使用公式，而非硬编码值

**始终使用 Excel 公式，而不是在 Python 中计算值后硬编码。** 这确保电子表格保持动态且可更新。

### ❌ 错误做法 - 硬编码计算值
```python
# 错误：在 Python 中计算并硬编码结果
total = df['Sales'].sum()
sheet['B10'] = total  # 硬编码 5000
```

### ✅ 正确做法 - 使用 Excel 公式
```python
# 正确：让 Excel 计算求和
sheet['B10'] = '=SUM(B2:B9)'
```

## 常见工作流程
1. **选择工具**：pandas 用于数据，openpyxl 用于公式/格式
2. **创建/加载**：创建新工作簿或加载现有文件
3. **修改**：添加/编辑数据、公式和格式
4. **保存**：写入文件
5. **重新计算公式（使用公式时必需）**：使用 recalc.py 脚本
   ```bash
   python recalc.py output.xlsx
   ```

## 最佳实践

### 库选择
- **pandas**：最适合数据分析、批量操作和简单的数据导出
- **openpyxl**：最适合复杂格式、公式和 Excel 特定功能

### 使用 openpyxl
- 单元格索引从 1 开始（row=1, column=1 指向单元格 A1）
- 使用 `data_only=True` 读取计算值：`load_workbook('file.xlsx', data_only=True)`
- **警告**：如果使用 `data_only=True` 打开并保存，公式将被替换为值并永久丢失

### 使用 pandas
- 指定数据类型以避免推断问题：`pd.read_excel('file.xlsx', dtype={'id': str})`
- 对于大文件，读取特定列：`pd.read_excel('file.xlsx', usecols=['A', 'C', 'E'])`

## 代码风格指南
**重要**：生成 Excel 操作的 Python 代码时：
- 编写简洁的 Python 代码，不要有不必要的注释
- 避免冗长的变量名和多余的操作
